{% extends 'base.html' %}

{% block title %}AI Enrichment - CRM{% endblock %}

{% block extra_css %}{% endblock %}

{% block content %}
{% if messages %}
<div class="ui messages">
    {% for message in messages %}
        <div class="ui {{ message.tags|default:'success' }} message">
            {{ message }}
        </div>
    {% endfor %}
</div>
{% endif %}

<div class="ui segment">
    <h2 class="ui header"><i class="robot icon"></i> AI Enrichment</h2>
    <p>Automatically enrich your company data with AI-powered information.</p>
    <div class="ui statistic">
        <div class="value">{{ companies_count }}</div>
        <div class="label">Companies ready for AI enrichment</div>
    </div>
    <form method="post" style="display: inline;">
        {% csrf_token %}
        <button type="submit" name="enrich_companies" class="ui primary button" {% if not enrichment_enabled or companies_count == 0 %}disabled{% endif %}>
            Start Company Enrichment
        </button>
    </form>
    {% if enrichment_enabled and companies_count > 0 %}
        <a href="{% url 'crm:ai_enrichment_stream' %}" target="_blank" class="ui button">Live progress</a>
    {% endif %}
</div>

<div class="ui segment">
    <h2 class="ui header"><i class="user icon"></i> Lead Enrichment</h2>
    <p>Automatically enrich your lead data (name, job title, LinkedIn) with AI-powered information.</p>
    <div class="ui statistic">
        <div class="value">{{ leads_count }}</div>
        <div class="label">Leads ready for AI enrichment</div>
    </div>
    <form method="post" style="display: inline;">
        {% csrf_token %}
        <button type="submit" name="enrich_leads" class="ui primary button" {% if not enrichment_enabled or leads_count == 0 %}disabled{% endif %}>
            Start Lead Enrichment
        </button>
    </form>
</div>

{% if not enrichment_enabled %}
<div class="ui yellow message">
    <div class="header">AI Enrichment is currently disabled.</div>
    Add <code>GENAI_API_KEY</code> and <code>OPENAI_API_KEY</code> to <code>keys.env</code> to enable.
</div>
{% endif %}

{% if companies_count == 0 %}
<div class="ui green message">
    <div class="header">All companies are already enriched!</div>
    There are no companies that need enrichment at the moment. Import new companies to enrich them.
</div>
{% endif %}

<div class="ui segment">
    <a href="{% url 'crm:home' %}" class="ui button">Back to Home</a>
</div>

{% endblock %}
