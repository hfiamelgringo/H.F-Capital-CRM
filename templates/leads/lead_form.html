{% extends 'base.html' %}

{% block title %}{{ title }} - CRM Django{% endblock %}

{% block extra_css %}{% endblock %}

{% block content %}
<div class="ui segment">
    <h2 class="ui header">{{ title }}</h2>
    
    <!-- Auto-calculated scoring info -->
    <div class="ui info message">
        <i class="close icon"></i>
        <div class="header">ðŸ’¡ Lead Scoring is Automated</div>
        <p>Lead score and stage are <strong>calculated automatically</strong> based on:</p>
        <ul style="margin: 10px 0;">
            <li>Session count & engagement</li>
            <li>Team adoption (users per domain)</li>
            <li>Job title hierarchy</li>
            <li>Email type (enterprise vs. free)</li>
            <li>Domain signals</li>
        </ul>
        <p style="margin: 10px 0;">Edit the fields below to trigger automatic score recalculation.</p>
    </div>
    
    <form method="post" class="ui form">
        {% csrf_token %}

        <div class="two fields">
            <div class="field">
                <label for="{{ form.email.id_for_label }}">Email *</label>
                {{ form.email }}
                {% if form.email.errors %}
                    <div class="ui pointing red basic label">
                        {% for error in form.email.errors %}{{ error }}{% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="field">
                <label for="{{ form.company.id_for_label }}">Company *</label>
                {{ form.company }}
                {% if form.company.errors %}
                    <div class="ui pointing red basic label">
                        {% for error in form.company.errors %}{{ error }}{% endfor %}
                    </div>
                {% endif %}
                <div class="ui tiny grey text">If it doesn't exist, <a href="{% url 'companies:company_create' %}" target="_blank">create it here</a></div>
            </div>
        </div>

        <div class="two fields">
            <div class="field">
                <label for="{{ form.pdl_first_name.id_for_label }}">First Name</label>
                {{ form.pdl_first_name }}
            </div>
            <div class="field">
                <label for="{{ form.pdl_last_name.id_for_label }}">Last Name</label>
                {{ form.pdl_last_name }}
            </div>
        </div>

        <div class="field">
            <label for="{{ form.pdl_job_title.id_for_label }}">Job Title</label>
            {{ form.pdl_job_title }}
        </div>

        <!-- Read-only Score and Stage (Auto-calculated) -->
        <div class="two fields">
            <div class="field">
                <label for="{{ form.lead_score.id_for_label }}">{{ form.lead_score.label }}</label>
                {{ form.lead_score }}
                <small class="form-text text-muted">Auto-calculated on save</small>
            </div>
            <div class="field">
                <label for="{{ form.lead_stage.id_for_label }}">{{ form.lead_stage.label }}</label>
                {{ form.lead_stage }}
                <small class="form-text text-muted">Auto-calculated on save</small>
            </div>
        </div>

        <div class="two fields">
            <div class="field">
                <label for="{{ form.hierarchical_level.id_for_label }}">Hierarchical Level</label>
                {{ form.hierarchical_level }}
            </div>
            <div class="field">
                <label for="{{ form.email_status.id_for_label }}">Email Status</label>
                {{ form.email_status }}
            </div>
        </div>

        <div class="field">
            <label for="{{ form.crm_owner.id_for_label }}">CRM Owner</label>
            {{ form.crm_owner }}
        </div>

        <div class="field">
            <div class="ui checkbox">
                {{ form.is_candidate_enterprise }}
                <label>Enterprise Candidate</label>
            </div>
        </div>

        <div class="ui divider"></div>
        <button type="submit" class="ui primary button">Save</button>
        <a href="{% url 'leads:lead_list' %}" class="ui button">Cancel</a>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    $('.ui.checkbox').checkbox();
</script>
{% endblock %}
